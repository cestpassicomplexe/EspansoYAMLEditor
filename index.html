<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="appTitle">Espanso YAML Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>

    <header>
        <div class="logo-container">
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                <span>Espanso YAML Editor</span>
            </div>
            <div class="header-subtitle" data-i18n="headerSubtitle">Créez vos raccourcis Espanso facilement</div>
        </div>
        <div class="actions">
            <div class="lang-switcher">
                <button class="lang-btn active" data-lang="fr">FR</button>
                <button class="lang-btn" data-lang="en">EN</button>
            </div>
            <button id="btnLoad" class="btn secondary">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="7 10 12 15 17 10" />
                    <line x1="12" y1="15" x2="12" y2="3" />
                </svg>
                <span data-i18n="btnOpen">Ouvrir</span>
            </button>
            <div class="dropdown-container">
                <div class="split-button">
                    <button id="btnSave" class="btn primary">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                            <polyline points="17 21 17 13 7 13 7 21" />
                            <polyline points="7 3 7 8 15 8" />
                        </svg>
                        <span data-i18n="btnSave">Enregistrer</span>
                    </button>
                    <button id="btnDropdown" class="btn primary dropdown-toggle" data-i18n-title="btnDropdownTitle"
                        title="Plus d'options">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                </div>
                <div id="saveDropdown" class="dropdown-menu hidden">
                    <button id="btnSaveAs" class="dropdown-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                            <path d="M17 21v-8H7v8" />
                            <path d="M7 3v5h8" />
                            <circle cx="18" cy="18" r="3" />
                        </svg>
                        <span data-i18n="btnSaveAs">Enregistrer sous...</span>
                    </button>
                </div>
            </div>
            <button id="btnHelp" class="btn secondary" data-i18n-title="btnHelpTitle" title="Aide">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10" />
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                    <line x1="12" y1="17" x2="12.01" y2="17" />
                </svg>
            </button>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="split-view">
                <!-- Sidebar for navigation -->
                <div class="sidebar-pane">
                    <div class="toolbar sidebar-toolbar">
                        <h3 data-i18n="sidebarTitle">Explorateur</h3>
                        <button id="btnSortAlpha" class="btn-icon" data-i18n-title="btnSortAlpha"
                            title="Trier par ordre alphabétique">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M11 5h10"></path>
                                <path d="M11 9h7"></path>
                                <path d="M11 13h4"></path>
                                <path d="M3 17l3 3 3-3"></path>
                                <path d="M6 18V4"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="sidebarList" class="sidebar-list">
                        <!-- Triggers will be listed here -->
                    </div>
                </div>

                <!-- Visual Editor Side -->
                <div class="visual-pane">
                    <div class="toolbar">
                        <div class="status-bar" id="statusMessage" data-i18n="statusEmpty">Prêt. Aucun fichier ouvert.
                        </div>
                        <button id="btnAdd" class="btn accent">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19" />
                                <line x1="5" y1="12" x2="19" y2="12" />
                            </svg>
                            <span data-i18n="btnAddMatch">Ajouter un Match</span>
                        </button>
                    </div>

                    <div id="matchesList" class="matches-grid">
                        <!-- Les cards seront générées ici par JS -->
                        <div class="empty-state">
                            <p data-i18n="welcomeMessage">Commencez par ouvrir un fichier <code>.yml</code> ou créez un
                                nouveau match.</p>
                        </div>
                    </div>
                </div>

                <!-- Live YAML Preview Side -->
                <div class="yaml-pane">
                    <div class="toolbar preview-toolbar">
                        <h3 data-i18n="yamlPreviewTitle">Aperçu YAML</h3>
                        <div class="actions">
                            <button id="btnFormatYaml" class="btn secondary small" data-i18n-title="btnFormatTitle"
                                title="Formater le code">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="4 7 4 4 20 4 20 7"></polyline>
                                    <line x1="9" y1="20" x2="15" y2="20"></line>
                                    <line x1="12" y1="4" x2="12" y2="20"></line>
                                </svg>
                                <span data-i18n="btnFormat">Formater</span>
                            </button>
                            <button id="btnCopyYaml" class="btn secondary small" data-i18n-title="btnCopyTitle"
                                title="Copier le contenu">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                <span data-i18n="btnCopy">Copier</span>
                            </button>
                        </div>
                    </div>
                    <textarea id="yamlEditor" spellcheck="false" data-i18n-placeholder="yamlPlaceholder"
                        placeholder="# Le contenu YAML apparaîtra ici..."></textarea>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal d'édition -->
    <div id="editorModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle" data-i18n="editMatch">Éditer le Match</h2>
                <button class="close-btn" id="btnCloseModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Overlay de sélection de type -->
                <div id="typeOverlay" class="type-overlay">
                    <div class="type-selection-content">
                        <h3 data-i18n="selectTypeTitle">Quel type de raccourci ?</h3>
                        <p data-i18n="selectTypeDesc">Choisissez le format de base. Ce choix ne pourra pas être modifié
                            pour ce raccourci.</p>
                        <div class="type-buttons-large">
                            <button class="type-btn-large" data-type="simple">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                                <span data-i18n="typeSimple">Texte Simple</span>
                            </button>
                            <button class="type-btn-large" data-type="form">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="4" width="18" height="12" rx="2"></rect>
                                    <path d="M7 20h10"></path>
                                    <path d="M9 16v4"></path>
                                    <path d="M15 16v4"></path>
                                    <path d="M7 8h10"></path>
                                    <path d="M7 12h4"></path>
                                </svg>
                                <span data-i18n="typeForm">Formulaire</span>
                            </button>
                            <button class="type-btn-large" data-type="date">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                <span data-i18n="typeDate">Date</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-group hidden">
                    <label for="matchType">
                        <span data-i18n="contentType">Type de contenu</span>
                        <i class="tooltip-icon" data-i18n-tooltip="tooltipContentType">?</i>
                    </label>
                    <div class="type-selector">
                        <label class="type-option">
                            <input type="radio" name="matchType" value="simple" checked>
                            <span data-i18n="typeSimple">Texte Simple</span>
                        </label>
                        <label class="type-option">
                            <input type="radio" name="matchType" value="form">
                            <span data-i18n="typeForm">Formulaire</span>
                        </label>
                        <label class="type-option">
                            <input type="radio" name="matchType" value="date">
                            <span data-i18n="typeDate">Date</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="triggerInput">
                        <span data-i18n="triggerLabel">Déclencheur (Trigger)</span>
                        <i class="tooltip-icon" data-i18n-tooltip="tooltipTrigger">?</i>
                    </label>
                    <input type="text" id="triggerInput" data-i18n-placeholder="triggerPlaceholder"
                        placeholder=":monraccourci">
                    <small data-i18n="triggerHelp">Le texte à taper pour déclencher le remplacement (ex: :date)</small>
                </div>

                <!-- Section Texte / Forme -->
                <div id="contentSection" class="form-group">
                    <label id="contentLabel" for="contentInput">
                        <span data-i18n="contentLabelReplacement">Texte de remplacement</span>
                        <i class="tooltip-icon" data-i18n-tooltip="tooltipContent">?</i>
                    </label>
                    <textarea id="contentInput" rows="6" data-i18n-placeholder="contentPlaceholder"
                        placeholder="Votre texte ici..."></textarea>
                    <small id="contentHelp" data-i18n="contentHelp">Vous pouvez utiliser plusieurs lignes.</small>
                </div>

                <!-- Visual Form Fields Builder -->
                <div id="formFieldsSection" class="form-group hidden">
                    <label>
                        <span data-i18n="specialFieldsTitle">Champs Spéciaux (Listes, Choix)</span>
                        <i class="tooltip-icon" data-i18n-tooltip="tooltipSpecialFields">?</i>
                    </label>
                    <div class="info-box">
                        <small data-i18n="specialFieldsHelp">Définissez ici les variables qui nécessitent un menu
                            déroulant ou une liste.</small>
                    </div>
                    <div id="fieldsList" class="fields-list">
                        <!-- Dynamic Fields Here -->
                    </div>
                    <button id="btnAddField" class="btn secondary small"><span data-i18n="btnAddField">+ Ajouter un
                            champ spécial</span></button>

                    <!-- Live Form Preview -->
                    <div id="formPreview" class="form-preview hidden">
                        <label data-i18n="formPreviewLabel">Aperçu du formulaire</label>
                        <div id="formPreviewContent" class="preview-ui"></div>
                    </div>

                    <!-- Templates for JS -->
                    <template id="fieldRowTemplate">
                        <div class="field-row">
                            <div class="field-header">
                                <input type="text" class="field-name" data-i18n-placeholder="fieldNamePlaceholder"
                                    placeholder="Nom variable (ex: choices)">
                                <button class="btn-icon remove-field" data-i18n-title="removeField"
                                    title="Supprimer">&times;</button>
                            </div>
                            <div class="field-body">
                                <div class="col">
                                    <label data-i18n="fieldType">Type</label>
                                    <select class="field-type">
                                        <option value="text">Texte (Input)</option>
                                        <option value="date" data-i18n="typeDate">Date</option>
                                        <option value="choice" data-i18n="fieldChoice">Choix (Dropdown)</option>
                                        <option value="list" data-i18n="fieldList">Liste (Selection)</option>
                                        <option value="text_multiline" data-i18n="fieldMultiline">Texte Multiligne
                                        </option>
                                    </select>
                                </div>
                                <div class="col">
                                    <label data-i18n="fieldValues">Valeurs (une par ligne)</label>
                                    <textarea class="field-values" rows="3"
                                        data-i18n-placeholder="fieldValuesPlaceholder"
                                        placeholder="Option 1&#10;Option 2"></textarea>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Section Specifique Date -->
                <div id="dateSection" class="form-group hidden">
                    <div class="info-box success" style="margin-bottom: 0.5rem;">
                        <small data-i18n="dateModeNote">Ce mode est optimisé pour les raccourcis de date simples. Pour
                            un formulaire mixant texte et date, préférez le mode "Formulaire".</small>
                    </div>
                    <label for="dateFormat">
                        <span data-i18n="dateFormatLabel">Format de la date</span>
                        <i class="tooltip-icon" data-i18n-tooltip="tooltipDateFormat">?</i>
                    </label>
                    <input type="text" id="dateFormat" value="%d/%m/%Y">
                    <small id="dateHelp">Paramètres : <code>%d</code> (jour), <code>%m</code> (mois), <code>%Y</code>
                        (année), <code>%H</code>:<code>%M</code> (heure).</small>

                    <div class="form-preview">
                        <label data-i18n="datePreviewLabel">Aperçu du résultat</label>
                        <div id="datePreview" class="preview-ui"></div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button id="btnDeleteMatch" class="btn danger" data-i18n="btnDelete">Supprimer</button>
                <div class="spacer"></div>
                <button id="btnCancel" class="btn secondary" data-i18n="btnCancel">Annuler</button>
                <button id="btnSaveMatch" class="btn primary" data-i18n="btnSaveMatch">Valider</button>
            </div>
        </div>
    </div>
    <!-- Help Modal -->
    <div id="helpModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="helpModalTitle">Comment utiliser cet outil ?</h2>
                <button class="close-btn" id="btnCloseHelp">&times;</button>
            </div>
            <div class="modal-body">
                <section>
                    <h3 data-i18n="whatIsEspanso">Qu'est-ce qu'Espanso ?</h3>
                    <p data-i18n="espansoDesc">Espanso est un <strong>remplaceur de texte</strong> (text expander). Il
                        surveille ce que vous tapez et remplace instantanément des mots-clés par du contenu plus long,
                        des dates, ou des formulaires complexes.</p>
                </section>

                <section>
                    <h3 data-i18n="whatIsTool">À quoi sert cet éditeur ?</h3>
                    <p data-i18n="toolDesc">Espanso utilise des fichiers <code>.yml</code> pour stocker vos raccourcis.
                        Ce site vous permet de :</p>
                    <ul>
                        <li data-i18n="feature1">Créer des raccourcis visuellement sans erreur de syntaxe.</li>
                        <li data-i18n="feature2">Gérer des formulaires avec choix et listes déroulantes.</li>
                        <li data-i18n="feature3">Générer des dates automatiques au bon format.</li>
                    </ul>
                </section>

                <section>
                    <h3 data-i18n="whereToSave">Où enregistrer vos fichiers ?</h3>
                    <p data-i18n="savePathDesc">Pour qu'Espanso détecte vos raccourcis, enregistrez votre fichier dans
                        le dossier <code>match</code> de votre configuration :</p>
                    <p class="help-tip" data-i18n="savePathTip">Astuce : Vous pouvez créer autant de fichiers .yml que
                        vous le souhaitez dans ce dossier pour organiser vos raccourcis par thèmes (ex : pro.yml,
                        perso.yml, etc.).</p>

                    <table class="os-table">
                        <thead>
                            <tr>
                                <th data-i18n="tableOS">Système</th>
                                <th data-i18n="tablePath">Chemin du répertoire /match</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Windows</strong></td>
                                <td>
                                    <code>%APPDATA%\espanso\match\</code>
                                    <button class="btn secondary small btn-copy-mini" data-i18n="btnCopyMini"
                                        onclick="copyText('%APPDATA%\\espanso\\match\\', this)">Copier</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>macOS</strong></td>
                                <td>
                                    <code>~/Library/Application Support/espanso/match/</code>
                                    <button class="btn secondary small btn-copy-mini" data-i18n="btnCopyMini"
                                        onclick="copyText('~/Library/Application Support/espanso/match/', this)">Copier</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Linux</strong></td>
                                <td>
                                    <code>~/.config/espanso/match/</code>
                                    <button class="btn secondary small btn-copy-mini" data-i18n="btnCopyMini"
                                        onclick="copyText('~/.config/espanso/match/', this)">Copier</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <div class="alert-box" data-i18n="securityNote">
                    <strong>Note :</strong> Pour des raisons de sécurité, les navigateurs ne peuvent pas écrire
                    directement dans vos dossiers système. Enregistrez le fichier sur votre bureau, puis déplacez-le
                    manuellement.
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnCloseHelpFooter" class="btn primary" data-i18n="btnGotIt">Compris</button>
            </div>
        </div>
    </div>

    <footer class="main-footer">
        <div class="footer-content">
            <p>
                <a href="https://espanso.org/" target="_blank" rel="noopener noreferrer">espanso.org</a>
            </p>
            <p class="credit">
                <span data-i18n="footerMadeWith">Fait avec</span> <span class="heart">❤️</span>
                <span data-i18n="footerBy">par</span> <a href="https://github.com/cestpassicomplexe" target="_blank"
                    rel="noopener noreferrer">cestpassicomplexe</a>
            </p>
        </div>
    </footer>

    <script src="script.js"></script>
</body>

</html>